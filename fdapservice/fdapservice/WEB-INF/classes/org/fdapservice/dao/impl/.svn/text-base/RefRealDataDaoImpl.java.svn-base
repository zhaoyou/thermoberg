package org.fdapservice.dao.impl;

import java.sql.CallableStatement;
import java.sql.Connection;


import org.apache.log4j.Logger;
import org.fdapservice.dao.RefRealDataDao;
import org.fdapservice.util.DBUtil;


/**
 * 冷库实时数据上传数据操作类
 * @author zhaoyou
 *
 */
public class RefRealDataDaoImpl implements RefRealDataDao {

	private Logger logger = Logger.getLogger(RefRealDataDaoImpl.class) ;
	
	@Override
	public Integer addRefRealData(String code, String source) {
		Connection con = null ;
		CallableStatement call = null ;
		String msg = null ;
		Integer result = null ; 
		try {
			con = DBUtil.getCon() ;
			call = con.prepareCall(RefRealDataDao.UPLOADREF) ;
			call.setString(1, code) ;
			call.setString(2, source) ;
			call.registerOutParameter(3, java.sql.Types.INTEGER);
			call.registerOutParameter(4, java.sql.Types.VARCHAR) ;
			call.execute() ;
			msg = call.getString(4);
			result = call.getInt(3);
			addLog(result, msg, logger);
			return  call.getInt(3);
		} catch (Exception e) {
			addLog(2,"调用存储过程失败("+msg+") ："+e.getMessage(),logger);
			return 2 ;
		}finally{
			DBUtil.closeStatement(call);
			DBUtil.closeCon(con) ;
		}
	}


	@Override
	public void addLog(Integer presult, String pmsg, Logger logger) {
		if(!presult.toString().equals("0")){
			logger.error(pmsg);
		}
		
	}
		
}
