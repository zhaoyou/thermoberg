package org.fdapservice.dao.impl;

import java.sql.CallableStatement;
import java.sql.Connection;

import org.apache.log4j.Logger;
import org.fdapservice.dao.CarRealDataDao;
import org.fdapservice.util.DBUtil;
/**
 * 车载实时数据上传数据访问实现类
 * @author zhoukuanwei
 *
 */
public class CarRealDataDaoImpl implements CarRealDataDao {
	private Logger logger = Logger.getLogger(RefRealDataDaoImpl.class) ;
	
	@Override
	public Integer uploadCarReal(String code, String psource) {
		Connection conn = null;
		CallableStatement call = null;
		String msg = "";
		Integer result = 0;
		try {
			conn = DBUtil.getCon();
			call = conn.prepareCall(CarRealDataDao.UPLOADCAR);
			call.setString(1, code);
			call.setString(2, psource);
			call.registerOutParameter(3, java.sql.Types.INTEGER);
			call.registerOutParameter(4, java.sql.Types.VARCHAR);
			call.execute();
			msg = call.getString(4);
			result = call.getInt(3);
			addLog(result, msg, logger);
			return call.getInt(3);
		} catch (Exception e) {
			addLog(2, "调用车载实时数据过程失败("+msg+"):"+e.getMessage(), logger);
			return 2;
		}finally{
			DBUtil.closeStatement(call);
			DBUtil.closeCon(conn) ;
		}
	}

	@Override
	public void addLog(Integer result, String msg, Logger log) {
		if(!result.toString().equals('0')){
			log.error(msg);
		}
	}

	
}
